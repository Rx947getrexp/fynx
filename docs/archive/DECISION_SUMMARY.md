# 项目重大决策总结

**日期**: 2025-10-18
**决策**: 推迟 v0.1.0 发布，补齐生产必需功能
**决策类型**: 产品策略调整

---

## 📋 决策背景

### 原计划

- ✅ 完成 Phase 1 (Stage 1-5)
- ✅ 发布 v0.1.0
- ⏳ Phase 2 实现公钥认证等功能

### 问题发现

在准备发布 v0.1.0 时，进行了**功能对比分析**（对比 OpenSSH、russh、ssh2-rs 等），发现：

#### 🔴 严重缺失

1. **无公钥认证** - 仅支持密码认证
   - 影响：无法用于任何自动化场景
   - 对比：所有其他 SSH 库都支持

2. **无 known_hosts 验证** - 接受任何主机密钥
   - 影响：极大安全风险，易受中间人攻击
   - 对比：OpenSSH/russh 都有完整支持

3. **无 authorized_keys** - 服务器端无公钥认证
   - 影响：服务器基本不可用
   - 对比：标准功能，所有库都支持

4. **无私钥文件加载** - 无法读取 ~/.ssh/id_rsa
   - 影响：公钥认证无法工作
   - 对比：基础功能

### 分析结论

**当前 fynx 状态**：
- ✅ 代码质量优秀（2120+ 行，175+ 测试）
- ✅ 架构设计现代（异步、零 unsafe）
- ✅ 协议实现完整（RFC 4251-4254）
- ❌ **功能完整度严重不足**
- ❌ **无法用于任何实际场景**

**如果按原计划发布 v0.1.0**：
- ❌ 用户无法使用（只能密码认证）
- ❌ 极不安全（无主机验证）
- ❌ 损害项目声誉
- ❌ 被视为"玩具项目"

---

## 🎯 决策内容

### 选择的方案：**方案 A - 推迟发布**

#### 当前版本定位

- **版本号**: v0.0.1-alpha（而非 v0.1.0）
- **定位**: 技术预览版（Technical Preview）
- **用途**:
  - ✅ 技术评估
  - ✅ 获取反馈
  - ✅ 开发测试
  - ❌ 生产部署

#### 新的发布计划

```
v0.0.1-alpha (2025-10-18) ✅ 已完成
├─ Phase 1 所有功能
├─ 明确标注 "NOT FOR PRODUCTION"
└─ 用于技术预览和反馈

↓ 8 周开发

v0.1.0 (2025-12-15) 🎯 真正可用
├─ 公钥认证 ✅
├─ known_hosts ✅
├─ authorized_keys ✅
├─ keyboard-interactive ✅
├─ 安全增强 ✅
└─ 生产就绪

↓ 9 周开发

v0.2.0 (2026-03-01) 🔮 功能完整
├─ SFTP 子系统 ✅
├─ 端口转发 ✅
├─ Keepalive ✅
└─ 功能完整
```

---

## 📊 方案对比

### 方案 A: 推迟发布（✅ 已选择）

**优点**：
- ✅ 发布即可用，不会失望用户
- ✅ 建立良好的第一印象
- ✅ 避免安全问题声誉损害
- ✅ 真正的"生产就绪"

**缺点**：
- ❌ 等待时间长（~2个月）
- ⚠️ 无法快速获得反馈

**时间线**：
- v0.0.1-alpha: 2025-10-18（技术预览）
- v0.1.0: 2025-12-15（生产就绪）

### 方案 B: 快速发布 alpha（未选择）

**优点**：
- ✅ 快速获得社区反馈
- ✅ 尽早建立存在感

**缺点**：
- ❌ "alpha 版"可能影响第一印象
- ❌ 仍需 2 个月才能真正可用
- ⚠️ 用户可能期待更高

### 方案 C: 继续原计划（❌ 不推荐）

**优点**：
- 无

**缺点**：
- ❌ 用户失望（无法使用）
- ❌ 严重安全风险（无 known_hosts）
- ❌ 项目声誉受损
- ❌ 被贴上"玩具"标签

---

## 🎯 v0.1.0 开发计划

### Stage 7: 公钥认证与密钥管理 (6 周)

#### Week 1-2: 私钥加载
- [ ] PEM 格式解析（RSA, Ed25519, ECDSA）
- [ ] OpenSSH 私钥格式
- [ ] 加密私钥解密
- [ ] 密码提示
- [ ] 15+ 测试

#### Week 3-4: 公钥认证实现
- [ ] 客户端公钥认证
- [ ] 服务器端公钥认证
- [ ] 签名生成/验证
- [ ] 8+ 测试

#### Week 5: known_hosts 支持
- [ ] 文件解析
- [ ] 主机密钥验证
- [ ] StrictHostKeyChecking 模式
- [ ] 哈希格式支持
- [ ] 12+ 测试

#### Week 6: authorized_keys 支持
- [ ] 文件解析
- [ ] 密钥选项（command, from, no-* 等）
- [ ] 选项强制执行
- [ ] 10+ 测试

### Stage 8: keyboard-interactive (1 周)

#### Week 7
- [ ] 协议实现
- [ ] 多轮交互
- [ ] PAM 框架
- [ ] 8+ 测试

### Stage 9: 安全增强 (1 周)

#### Week 8
- [ ] 认证速率限制
- [ ] 连接数限制
- [ ] 审计日志
- [ ] Banner 支持
- [ ] 15+ 测试

### 总计

- **时间**: 8 周（2 个月）
- **新增代码**: ~3,000 行
- **新增测试**: 68+ 个
- **目标日期**: 2025-12-15

---

## 📈 预期成果

### v0.1.0 发布后

**功能完整性**:
- ✅ 3 种认证方式（密码、公钥、keyboard-interactive）
- ✅ 安全的主机密钥验证
- ✅ 服务器端公钥授权
- ✅ 生产级安全控制

**可用场景**:
- ✅ 自动化脚本（公钥认证）
- ✅ 服务器管理（SSH 访问）
- ✅ 企业部署（MFA、审计）
- ⚠️ 文件传输（需 v0.2.0 SFTP）
- ⚠️ 端口转发（需 v0.2.0）

**质量标准**:
- ✅ 243+ 测试全部通过
- ✅ OpenSSH 互操作验证
- ✅ 外部安全审计
- ✅ 零 unsafe 代码
- ✅ 完整文档

---

## 🔄 风险与缓解

### 主要风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 开发时间超出 | 中 | 中 | 20% 缓冲时间，优先级管理 |
| 私钥格式兼容性 | 高 | 中 | 参考 russh 实现，广泛测试 |
| OpenSSH 不兼容 | 高 | 低 | 早期测试，持续验证 |
| 社区失去兴趣 | 低 | 低 | alpha 版获取早期反馈 |

### 应对措施

1. **进度跟踪**
   - 每周检查进度
   - 及时调整优先级
   - 关键路径管理

2. **质量保证**
   - 边开发边测试
   - OpenSSH 持续验证
   - 代码审查

3. **沟通透明**
   - 公开路线图
   - 定期进度更新
   - 接受社区反馈

---

## 📣 沟通策略

### v0.0.1-alpha 发布公告

**标题**: "Fynx SSH v0.0.1-alpha: 技术预览版发布"

**重点**:
- ✅ 强调"技术预览"定位
- ✅ 明确说明限制
- ✅ 展示技术亮点
- ✅ 公布 v0.1.0 路线图

**渠道**:
- GitHub Release
- Reddit (r/rust)
- Rust Users Forum
- Twitter/X

### v0.1.0 发布公告

**标题**: "Fynx SSH v0.1.0: 生产就绪版发布"

**重点**:
- ✅ 公钥认证等新功能
- ✅ 安全性增强
- ✅ 生产可用
- ✅ 性能基准
- ✅ OpenSSH 兼容

---

## 💡 经验教训

### 应该继续的

1. **高质量代码标准** - 零 unsafe，完整测试
2. **详细文档** - 每个阶段都有完整文档
3. **渐进式开发** - Stage-by-Stage 方法有效
4. **用户视角思考** - 功能对比分析很重要

### 应该改进的

1. **更早做功能对比** - 应该在开发初期就对比
2. **明确发布标准** - 提前定义"生产就绪"的标准
3. **用户场景验证** - 更早考虑实际使用场景

### 关键洞察

1. **代码质量 ≠ 产品可用性**
   - 代码可以很优秀
   - 但功能不全就不是产品

2. **技术实现 ≠ 用户价值**
   - 协议实现完整
   - 但用户场景覆盖不足

3. **发布时机很重要**
   - 太早发布 = 失望用户
   - 适时发布 = 建立信任

---

## 🎯 成功标准

### v0.1.0 发布条件

**必须全部满足**:

- [ ] 公钥认证完整实现
- [ ] known_hosts 完整支持
- [ ] authorized_keys 完整支持
- [ ] keyboard-interactive 实现
- [ ] 安全控制完整
- [ ] 243+ 测试全部通过
- [ ] OpenSSH 8.0+, 9.0+ 验证通过
- [ ] 外部安全审计通过
- [ ] 完整文档
- [ ] 无已知严重漏洞

**发布后评估**:

- [ ] 1 周内无严重 bug 报告
- [ ] 社区正面反馈
- [ ] 下载量 > 100 (crates.io)
- [ ] Star 增长 > 10 (GitHub)

---

## 📅 关键日期

| 日期 | 里程碑 | 备注 |
|------|--------|------|
| 2025-10-18 | v0.0.1-alpha 发布 | ✅ 完成 |
| 2025-10-21 | Stage 7.1 开始 | 私钥加载 |
| 2025-11-04 | Stage 7.2 开始 | 公钥认证 |
| 2025-11-18 | Stage 7.3 开始 | known_hosts |
| 2025-11-25 | Stage 7.4 开始 | authorized_keys |
| 2025-12-02 | Stage 8 开始 | keyboard-interactive |
| 2025-12-09 | Stage 9 开始 | 安全增强 |
| 2025-12-15 | **v0.1.0 发布** | 🎯 目标 |
| 2026-03-01 | v0.2.0 计划 | SFTP + 端口转发 |

---

## 🏆 项目里程碑

### 已完成 ✅

- [x] 2025-01-17: Stage 1 & 2 完成
- [x] 2025-10-17: Stage 3 & 4 完成
- [x] 2025-10-18: Stage 5 完成（Phase 1）
- [x] 2025-10-18: 功能对比分析
- [x] 2025-10-18: 决策推迟发布
- [x] 2025-10-18: v0.0.1-alpha 文档完成

### 计划中 📅

- [ ] 2025-12-15: v0.1.0 发布（生产就绪）
- [ ] 2026-03-01: v0.2.0 发布（功能完整）
- [ ] 2026 Q2: v0.3.0（高级功能）

---

## ✅ 决策批准

**决策者**: Project Lead
**批准日期**: 2025-10-18
**批准理由**:
- 功能对比分析清晰
- 风险评估充分
- 时间规划合理
- 符合长期利益

**利益相关方同意**:
- [x] 核心开发者
- [x] 技术顾问（AI Assistant）
- [ ] 社区成员（待公告后）

---

**文档版本**: 1.0
**最后更新**: 2025-10-18
**下次审查**: v0.1.0 发布后
